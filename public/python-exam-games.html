<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Exam 1 - Interactive Learning Games üéÆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .game-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            padding: 40px;
        }

        .game-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .game-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .game-card h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .game-card p {
            color: #666;
            line-height: 1.6;
        }

        .game-area {
            display: none;
            padding: 40px;
            min-height: 600px;
        }

        .game-area.active {
            display: block;
        }

        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: #5a6268;
            transform: translateX(-3px);
        }

        /* Wordle Game Styles */
        .wordle-grid {
            display: grid;
            gap: 8px;
            margin: 30px auto;
            max-width: 400px;
        }

        .wordle-row {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .wordle-cell {
            aspect-ratio: 1;
            border: 2px solid #d3d6da;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 4px;
            background: white;
        }

        .wordle-cell.correct {
            background: #6aaa64;
            border-color: #6aaa64;
            color: white;
        }

        .wordle-cell.present {
            background: #c9b458;
            border-color: #c9b458;
            color: white;
        }

        .wordle-cell.absent {
            background: #787c7e;
            border-color: #787c7e;
            color: white;
        }

        .wordle-cell.filled {
            border-color: #878a8c;
        }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 6px;
            max-width: 600px;
            margin: 20px auto;
        }

        .key {
            padding: 15px 10px;
            background: #d3d6da;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.1s;
        }

        .key:hover {
            background: #c3c6ca;
        }

        .key.correct {
            background: #6aaa64;
            color: white;
        }

        .key.present {
            background: #c9b458;
            color: white;
        }

        .key.absent {
            background: #787c7e;
            color: white;
        }

        .key.wide {
            grid-column: span 2;
        }

        /* Flashcard Styles */
        .flashcard-container {
            perspective: 1000px;
            max-width: 600px;
            margin: 30px auto;
        }

        .flashcard {
            width: 100%;
            height: 400px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .flashcard-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flashcard-back {
            background: #f8f9fa;
            transform: rotateY(180deg);
        }

        .flashcard-front h2 {
            font-size: 2em;
            text-align: center;
        }

        .flashcard-back .answer {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .flashcard-back .explanation {
            color: #666;
            line-height: 1.8;
            text-align: center;
        }

        .flashcard-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        /* Matching Game Styles */
        .matching-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 800px;
            margin: 30px auto;
        }

        .matching-card {
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .matching-card:hover {
            background: #e9ecef;
        }

        .matching-card.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .matching-card.matched {
            background: #28a745;
            color: white;
            border-color: #28a745;
            cursor: default;
        }

        .matching-card.wrong {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Speed Quiz Styles */
        .quiz-question {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .quiz-question h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .quiz-options {
            display: grid;
            gap: 12px;
        }

        .quiz-option {
            background: white;
            border: 2px solid #dee2e6;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
        }

        .quiz-option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .quiz-option.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .quiz-option.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .timer {
            font-size: 2em;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .score-display {
            text-align: center;
            font-size: 1.5em;
            color: #667eea;
            margin: 20px 0;
            font-weight: bold;
        }

        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
            border: 1px solid #3e3e3e;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .code-block .keyword {
            color: #569cd6;
            font-weight: 600;
        }

        .code-block .string {
            color: #ce9178;
        }

        .code-block .number {
            color: #b5cea8;
        }

        .code-block .function {
            color: #dcdcaa;
        }

        .code-block .comment {
            color: #6a9955;
            font-style: italic;
        }

        .code-block .operator {
            color: #d4d4d4;
        }

        .hint-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .success-message {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .game-menu {
                grid-template-columns: 1fr;
            }

            .matching-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .leaderboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .leaderboard-header h2 {
            margin: 0;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .leaderboard-header p {
            margin: 10px 0 0 0;
            opacity: 0.95;
            font-size: 1.1em;
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-section label {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.05em;
        }

        .filter-section select {
            padding: 12px 20px;
            border-radius: 8px;
            border: 2px solid #667eea;
            background: white;
            color: #2d3748;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }

        .filter-section select:hover {
            border-color: #764ba2;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .filter-section select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .leaderboard-entry {
            background: white;
            padding: 20px 25px;
            margin: 12px 0;
            border-radius: 15px;
            display: grid;
            grid-template-columns: 70px 1fr auto;
            align-items: center;
            gap: 20px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .leaderboard-entry:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .leaderboard-entry.gold {
            border: 3px solid #ffd700;
            background: linear-gradient(135deg, #fffbea 0%, #ffffff 100%);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.25);
        }

        .leaderboard-entry.gold:hover {
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.35);
        }

        .leaderboard-entry.silver {
            border: 3px solid #c0c0c0;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            box-shadow: 0 6px 20px rgba(192, 192, 192, 0.25);
        }

        .leaderboard-entry.silver:hover {
            box-shadow: 0 10px 30px rgba(192, 192, 192, 0.35);
        }

        .leaderboard-entry.bronze {
            border: 3px solid #cd7f32;
            background: linear-gradient(135deg, #fff5eb 0%, #ffffff 100%);
            box-shadow: 0 6px 20px rgba(205, 127, 50, 0.25);
        }

        .leaderboard-entry.bronze:hover {
            box-shadow: 0 10px 30px rgba(205, 127, 50, 0.35);
        }

        .leaderboard-rank {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .leaderboard-entry.gold .leaderboard-rank {
            font-size: 2.5em;
            filter: drop-shadow(0 2px 4px rgba(255, 215, 0, 0.4));
        }

        .leaderboard-entry.silver .leaderboard-rank {
            font-size: 2.3em;
            filter: drop-shadow(0 2px 4px rgba(192, 192, 192, 0.4));
        }

        .leaderboard-entry.bronze .leaderboard-rank {
            font-size: 2.2em;
            filter: drop-shadow(0 2px 4px rgba(205, 127, 50, 0.4));
        }

        .leaderboard-player {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .leaderboard-player .name {
            font-weight: 700;
            font-size: 1.2em;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .leaderboard-player .game {
            font-size: 0.95em;
            color: #667eea;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .leaderboard-player .timestamp {
            font-size: 0.85em;
            color: #999;
            font-style: italic;
        }

        .leaderboard-score {
            font-size: 1.6em;
            font-weight: bold;
            color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: right;
            min-width: 120px;
        }

        .leaderboard-entry.gold .leaderboard-score {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .leaderboard-entry.silver .leaderboard-score {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .leaderboard-entry.bronze .leaderboard-score {
            background: linear-gradient(135deg, #cd7f32 0%, #e59866 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-leaderboard {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .empty-leaderboard .icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-leaderboard p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 25px;
        }

        .game-icon {
            display: inline-block;
            font-size: 1.1em;
        }

        .dice {
            width: 100px;
            height: 100px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            margin: 20px auto;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .dice:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .dice.rolling {
            animation: roll 0.5s ease;
        }

        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        .bug-code {
            background: #ffe6e6;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            color: #2d3748;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            line-height: 1.8;
        }

        .bug-code div {
            color: #2d3748;
            font-weight: 500;
        }

        .bug-code div:hover {
            background: #fff3cd !important;
            font-weight: 600;
        }

        .bug-fixed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .battle-arena {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .battle-player {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .battle-player.active {
            border: 3px solid #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .health-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .leaderboard-entry {
                grid-template-columns: 50px 1fr auto;
                padding: 15px 18px;
                gap: 12px;
            }

            .leaderboard-rank {
                font-size: 1.5em;
            }

            .leaderboard-entry.gold .leaderboard-rank,
            .leaderboard-entry.silver .leaderboard-rank,
            .leaderboard-entry.bronze .leaderboard-rank {
                font-size: 1.8em;
            }

            .leaderboard-player .name {
                font-size: 1em;
            }

            .leaderboard-player .game {
                font-size: 0.85em;
            }

            .leaderboard-score {
                font-size: 1.2em;
                min-width: 80px;
            }

            .filter-section {
                padding: 15px;
            }

            .filter-section select {
                min-width: 150px;
                padding: 10px 15px;
            }

            .leaderboard-header h2 {
                font-size: 1.6em;
            }

            .leaderboard-header p {
                font-size: 0.95em;
            }
        }

        @media (max-width: 480px) {
            .leaderboard-player .timestamp {
                font-size: 0.75em;
            }

            .leaderboard-score div {
                font-size: 0.4em !important;
            }
        }

        /* Custom Modal Styles */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.4s ease;
        }

        .modal-header {
            font-size: 2.5em;
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-message {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .modal-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .modal-btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .modal-btn-secondary:hover {
            background: #cbd5e0;
        }

        .modal-success {
            border-top: 5px solid #28a745;
        }

        .modal-error {
            border-top: 5px solid #dc3545;
        }

        .modal-info {
            border-top: 5px solid #667eea;
        }

        .modal-warning {
            border-top: 5px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Python Exam 1 - Learning Games</h1>
            <p>Master Python concepts through interactive challenges!</p>
            <button class="btn btn-primary" onclick="showLeaderboard()" style="margin-top: 20px;">üèÜ View Leaderboard</button>
        </div>

        <!-- Game Menu -->
        <div id="game-menu" class="game-menu">
            <div class="game-card" onclick="startGame('wordle')">
                <div class="icon">üî§</div>
                <h3>Code Wordle</h3>
                <p>Guess Python keywords and operators in 6 tries! Similar to Wordle but with programming terms.</p>
            </div>

            <div class="game-card" onclick="startGame('flashcards')">
                <div class="icon">üé¥</div>
                <h3>Smart Flashcards</h3>
                <p>Flip through interactive flashcards covering all exam topics. Test your knowledge!</p>
            </div>

            <div class="game-card" onclick="startGame('matching')">
                <div class="icon">üéØ</div>
                <h3>Match Master</h3>
                <p>Match Python concepts with their definitions. Clear all pairs to win!</p>
            </div>

            <div class="game-card" onclick="startGame('speed-quiz')">
                <div class="icon">‚ö°</div>
                <h3>Speed Quiz</h3>
                <p>Race against the clock! Answer as many questions correctly as possible.</p>
            </div>

            <div class="game-card" onclick="startGame('code-challenge')">
                <div class="icon">üíª</div>
                <h3>Code Challenges</h3>
                <p>Fix broken code, predict outputs, and debug common errors!</p>
            </div>

            <div class="game-card" onclick="startGame('fill-blank')">
                <div class="icon">üìù</div>
                <h3>Fill the Blanks</h3>
                <p>Complete Python code snippets by filling in missing keywords and values.</p>
            </div>

            <div class="game-card" onclick="startGame('dice-roll')">
                <div class="icon">üé≤</div>
                <h3>Dice Roll Challenge</h3>
                <p>Roll the dice! Higher rolls unlock harder questions with more points!</p>
            </div>

            <div class="game-card" onclick="startGame('bug-hunter')">
                <div class="icon">üîç</div>
                <h3>Bug Hunter</h3>
                <p>Find and fix bugs in Python code. Earn points for each bug you catch!</p>
            </div>

            <div class="game-card" onclick="startGame('battle-quiz')">
                <div class="icon">‚öîÔ∏è</div>
                <h3>Battle Quiz</h3>
                <p>Compete against AI! Race to answer questions correctly. Best of 5 wins!</p>
            </div>
        </div>

        <!-- Wordle Game -->
        <div id="wordle-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">Python Code Wordle</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">Guess the Python keyword or operator!</p>
            
            <div class="score-display">Streak: <span id="wordle-streak">0</span> üî•</div>
            
            <div class="wordle-grid" id="wordle-grid"></div>
            
            <div class="hint-box" id="wordle-hint"></div>
            
            <div class="keyboard" id="keyboard"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="newWordleGame()">New Word</button>
            </div>
        </div>

        <!-- Flashcards Game -->
        <div id="flashcards-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">Smart Flashcards</h2>
            
            <div class="score-display">
                Card <span id="current-card">1</span> of <span id="total-cards">20</span>
            </div>
            
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-face flashcard-front">
                        <h2 id="question-text"></h2>
                    </div>
                    <div class="flashcard-face flashcard-back">
                        <div class="answer" id="answer-text"></div>
                        <div class="explanation" id="explanation-text"></div>
                    </div>
                </div>
            </div>
            
            <div class="flashcard-controls">
                <button class="btn btn-danger" onclick="previousCard()">‚¨Ö Previous</button>
                <button class="btn btn-primary" onclick="flipCard()">Flip Card</button>
                <button class="btn btn-success" onclick="nextCard()">Next ‚û°</button>
            </div>
        </div>

        <!-- Matching Game -->
        <div id="matching-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">Match Master</h2>
            
            <div class="score-display">
                Matches: <span id="matches-count">0</span> / <span id="total-matches">8</span> | 
                Moves: <span id="moves-count">0</span>
            </div>
            
            <div class="matching-grid" id="matching-grid"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="resetMatchingGame()">Reset Game</button>
            </div>
        </div>

        <!-- Speed Quiz -->
        <div id="speed-quiz-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">‚ö° Speed Quiz Challenge</h2>
            
            <div class="timer" id="timer">60</div>
            <div class="score-display">Score: <span id="quiz-score">0</span> / <span id="quiz-total">0</span></div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            
            <div id="speed-quiz-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="startSpeedQuiz()">Start Quiz</button>
            </div>
        </div>

        <!-- Code Challenge -->
        <div id="code-challenge-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">üíª Code Challenges</h2>
            
            <div class="score-display">Challenge <span id="challenge-num">1</span> of 10</div>
            
            <div id="code-challenge-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="nextChallenge()">Next Challenge ‚û°</button>
            </div>
        </div>

        <!-- Fill the Blanks -->
        <div id="fill-blank-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">üìù Fill the Blanks</h2>
            
            <div class="score-display">Progress: <span id="blank-progress">0</span> / 15</div>
            
            <div id="fill-blank-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="checkBlanks()">Check Answers</button>
                <button class="btn btn-success" onclick="nextBlankChallenge()">Next ‚û°</button>
            </div>
        </div>

        <!-- Leaderboard Area -->
        <div id="leaderboard-area" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            
            <div class="leaderboard-container">
                <div class="leaderboard-header">
                    <h2>üèÜ Global Leaderboard</h2>
                    <p>Top performers across all Python learning games</p>
                </div>
                
                <div class="filter-section">
                    <label for="filter-game">üéØ Filter by Game:</label>
                    <select id="filter-game" onchange="displayLeaderboard()">
                        <option value="all">üéÆ All Games</option>
                        <option value="wordle">üî§ Code Wordle</option>
                        <option value="flashcards">üé¥ Smart Flashcards</option>
                        <option value="matching">üéØ Match Master</option>
                        <option value="speed-quiz">‚ö° Speed Quiz</option>
                        <option value="code-challenge">üíª Code Challenges</option>
                        <option value="fill-blank">üìù Fill the Blanks</option>
                        <option value="dice-roll">üé≤ Dice Roll</option>
                        <option value="bug-hunter">üîç Bug Hunter</option>
                        <option value="battle-quiz">‚öîÔ∏è Battle Quiz</option>
                    </select>
                </div>
                
                <div id="leaderboard-list"></div>
            </div>
        </div>
        
        <!-- Dice Roll Game -->
        <div id="dice-roll-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">üé≤ Dice Roll Challenge</h2>
            
            <div class="score-display">Score: <span id="dice-score">0</span></div>
            
            <div style="text-align: center; margin: 30px 0;">
                <p style="font-size: 1.2em; color: #555;">Roll the dice to determine your question difficulty!</p>
                <div class="dice" id="dice" onclick="rollDice()">üé≤</div>
                <p id="dice-result" style="font-size: 1.1em; font-weight: 600; color: #667eea; margin-top: 10px;"></p>
            </div>
            
            <div id="dice-question-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="submitDiceScore()">Submit Score to Leaderboard</button>
                <button class="btn btn-secondary" onclick="startDiceRoll()">New Game</button>
            </div>
        </div>

        <!-- Bug Hunter Game -->
        <div id="bug-hunter-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">üîç Bug Hunter</h2>
            
            <div class="score-display">
                Bugs Found: <span id="bugs-found">0</span> / <span id="total-bugs">5</span> | 
                Score: <span id="bug-score">0</span>
            </div>
            
            <div id="bug-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="submitBugScore()">Submit Score to Leaderboard</button>
                <button class="btn btn-secondary" onclick="startBugHunter()">New Game</button>
            </div>
        </div>

        <!-- Battle Quiz Game -->
        <div id="battle-quiz-game" class="game-area">
            <button class="back-button" onclick="backToMenu()">‚¨Ö Back to Menu</button>
            <h2 style="text-align: center; color: #667eea; margin-bottom: 10px;">‚öîÔ∏è Battle Quiz</h2>
            
            <div class="battle-arena">
                <div class="battle-player" id="player-area">
                    <h3>üë§ You</h3>
                    <div class="health-bar">
                        <div class="health-fill" id="player-health" style="width: 100%"></div>
                    </div>
                    <p>Health: <span id="player-health-text">100</span></p>
                    <p>Score: <span id="player-score">0</span></p>
                </div>
                
                <div class="battle-player" id="ai-area">
                    <h3>ü§ñ AI Opponent</h3>
                    <div class="health-bar">
                        <div class="health-fill" id="ai-health" style="width: 100%"></div>
                    </div>
                    <p>Health: <span id="ai-health-text">100</span></p>
                    <p>Score: <span id="ai-score">0</span></p>
                </div>
            </div>
            
            <div id="battle-question-container"></div>
            
            <div id="battle-result" style="text-align: center; margin-top: 30px;"></div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="startBattleQuiz()">Start Battle</button>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div id="customModal" class="custom-modal">
        <div id="modalContent" class="modal-content">
            <div id="modalIcon" class="modal-header"></div>
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalMessage" class="modal-message"></div>
            <div id="modalInputContainer"></div>
            <div id="modalButtons" class="modal-buttons"></div>
        </div>
    </div>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            orderBy, 
            updateDoc, 
            doc,
            serverTimestamp 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Load Firebase config with custom domain for auth persistence
        const firebaseConfig = window.firebaseConfig || {
            apiKey: "AIzaSyAIwwM2V2qfPCB3TLVVeb8IW3FGxdNDhiY",
            authDomain: "codewithmorais.com",
            projectId: "code-with-morais-405",
            storageBucket: "code-with-morais-405.firebasestorage.app",
            messagingSenderId: "208072504611",
            appId: "1:208072504611:web:8ebd20260a9e16ceff8896",
            measurementId: "G-JLH66GJNFL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();
        let currentUser = null;

        // Make auth, db and signInWithGoogle available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.currentUser = null;
        
        // Make Firestore functions available globally
        window.firestoreCollection = collection;
        window.firestoreAddDoc = addDoc;
        window.firestoreGetDocs = getDocs;
        window.firestoreQuery = query;
        window.firestoreWhere = where;
        window.firestoreOrderBy = orderBy;
        window.firestoreUpdateDoc = updateDoc;
        window.firestoreDoc = doc;
        window.firestoreServerTimestamp = serverTimestamp;

        // Sign in with Google
        window.signInWithGoogle = async function() {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                return result.user;
            } catch (error) {
                console.error('Sign-in error:', error);
                showCustomAlert(
                    'Please try again or check your internet connection.',
                    'Sign-in Failed',
                    '‚ùå',
                    'error'
                );
                return null;
            }
        };

        // Show welcome message for logged in users
        function showWelcomeMessage(user) {
            const header = document.querySelector('.header');
            let welcomeDiv = document.getElementById('welcomeMessage');
            
            if (!welcomeDiv) {
                welcomeDiv = document.createElement('div');
                welcomeDiv.id = 'welcomeMessage';
                welcomeDiv.style.cssText = `
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 10px;
                    padding: 15px;
                    margin-top: 20px;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    justify-content: center;
                    backdrop-filter: blur(10px);
                `;
                header.appendChild(welcomeDiv);
            }
            
            const photoHTML = user.photoURL 
                ? `<img src="${user.photoURL}" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid white;" alt="Profile">`
                : 'üë§';
            
            welcomeDiv.innerHTML = `
                ${photoHTML}
                <span style="font-size: 1.1em;">Welcome back, <strong>${user.displayName || user.email}</strong>! üéÆ</span>
            `;
        }

        // Auth state listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            window.currentUser = user;
            
            if (user) {
                console.log('User signed in:', user.displayName || user.email);
                showWelcomeMessage(user);
            } else {
                console.log('User not signed in');
                const welcomeDiv = document.getElementById('welcomeMessage');
                if (welcomeDiv) welcomeDiv.remove();
            }
        });
    </script>

    <script>

        // Custom Modal Functions
        function showCustomAlert(message, title = '', icon = '‚úì', type = 'success') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const modalContent = document.getElementById('modalContent');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalInputContainer = document.getElementById('modalInputContainer');
                const modalButtons = document.getElementById('modalButtons');

                // Reset classes
                modalContent.className = 'modal-content modal-' + type;
                
                // Set content
                modalIcon.textContent = icon;
                modalTitle.textContent = title;
                modalMessage.innerHTML = message;
                modalInputContainer.innerHTML = '';
                
                // Create button
                modalButtons.innerHTML = `
                    <button class="modal-btn modal-btn-primary" onclick="closeCustomModal(); window.modalResolve();">
                        OK
                    </button>
                `;
                
                // Show modal
                modal.style.display = 'block';
                
                // Store resolve function
                window.modalResolve = resolve;
            });
        }

        function showCustomConfirm(message, title = 'Confirm', icon = '‚ùì') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const modalContent = document.getElementById('modalContent');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalInputContainer = document.getElementById('modalInputContainer');
                const modalButtons = document.getElementById('modalButtons');

                modalContent.className = 'modal-content modal-warning';
                modalIcon.textContent = icon;
                modalTitle.textContent = title;
                modalMessage.innerHTML = message;
                modalInputContainer.innerHTML = '';
                
                modalButtons.innerHTML = `
                    <button class="modal-btn modal-btn-secondary" onclick="closeCustomModal(); window.modalResolve(false);">
                        Cancel
                    </button>
                    <button class="modal-btn modal-btn-primary" onclick="closeCustomModal(); window.modalResolve(true);">
                        Confirm
                    </button>
                `;
                
                modal.style.display = 'block';
                window.modalResolve = resolve;
            });
        }

        function showCustomPrompt(message, title = '', placeholder = '', icon = '‚úèÔ∏è') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const modalContent = document.getElementById('modalContent');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalInputContainer = document.getElementById('modalInputContainer');
                const modalButtons = document.getElementById('modalButtons');

                modalContent.className = 'modal-content modal-info';
                modalIcon.textContent = icon;
                modalTitle.textContent = title;
                modalMessage.innerHTML = message;
                
                modalInputContainer.innerHTML = `
                    <input type="text" id="modalInput" class="modal-input" placeholder="${placeholder}" autofocus>
                `;
                
                modalButtons.innerHTML = `
                    <button class="modal-btn modal-btn-secondary" onclick="closeCustomModal(); window.modalResolve(null);">
                        Cancel
                    </button>
                    <button class="modal-btn modal-btn-primary" onclick="closeCustomModal(); window.modalResolve(document.getElementById('modalInput').value);">
                        Submit
                    </button>
                `;
                
                modal.style.display = 'block';
                window.modalResolve = resolve;
                
                // Focus input after a brief delay
                setTimeout(() => {
                    const input = document.getElementById('modalInput');
                    if (input) {
                        input.focus();
                        // Submit on Enter key
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                closeCustomModal();
                                window.modalResolve(input.value);
                            }
                        });
                    }
                }, 100);
            });
        }

        function closeCustomModal() {
            document.getElementById('customModal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('customModal');
            if (e.target === modal) {
                closeCustomModal();
                if (window.modalResolve) {
                    window.modalResolve(null);
                }
            }
        });

        // Game state
        let currentGame = null;
        let currentCardIndex = 0;
        let wordleStreak = 0;
        let currentWordleWord = '';
        let currentWordleAttempt = 0;
        let matchingSelected = [];
        let matchingMatches = 0;
        let matchingMoves = 0;
        let speedQuizTimer = null;
        let speedQuizScore = 0;
        let speedQuizTotal = 0;
        let currentChallengeIndex = 0;
        let currentBlankIndex = 0;

        // Game data
        const wordleWords = [
            { word: 'IMPORT', hint: 'Keyword to bring in modules' },
            { word: 'RETURN', hint: 'Sends a value back from a function' },
            { word: 'WHILE', hint: 'Loop that continues while condition is true' },
            { word: 'EXCEPT', hint: 'Catches errors in try-except blocks' },
            { word: 'APPEND', hint: 'Method to add item to end of list' },
            { word: 'PRINT', hint: 'Displays output to console' },
            { word: 'INPUT', hint: 'Gets user input as string' },
            { word: 'CLASS', hint: 'Defines a blueprint for objects' },
            { word: 'BREAK', hint: 'Exits a loop early' },
            { word: 'RAISE', hint: 'Triggers an exception' }
        ];

        const flashcards = [
            { 
                question: 'What does int() do?', 
                answer: 'Converts to integer',
                explanation: 'int() converts a value to an integer. Example: int("5") returns 5'
            },
            { 
                question: 'What does str() do?', 
                answer: 'Converts to string',
                explanation: 'str() converts any value to a string. Example: str(123) returns "123"'
            },
            { 
                question: 'What does float() do?', 
                answer: 'Converts to decimal number',
                explanation: 'float() converts to a floating-point number. Example: float("3.14") returns 3.14'
            },
            { 
                question: 'What operator checks equality?', 
                answer: '==',
                explanation: 'Use == to compare values. Example: 5 == 5 returns True'
            },
            { 
                question: 'What is floor division operator?', 
                answer: '//',
                explanation: '// divides and returns integer part. Example: 7 // 2 returns 3'
            },
            { 
                question: 'What is modulus operator?', 
                answer: '%',
                explanation: '% returns remainder. Example: 7 % 2 returns 1'
            },
            { 
                question: 'What does append() do?', 
                answer: 'Adds item to end of list',
                explanation: 'list.append(item) adds item to the end. Modifies list in-place.'
            },
            { 
                question: 'What does pop() do?', 
                answer: 'Removes and returns last item',
                explanation: 'list.pop() removes and returns the last item from a list'
            },
            { 
                question: 'How to check if item is in list?', 
                answer: 'Use "in" keyword',
                explanation: 'Example: "apple" in fruits returns True if apple is in the list'
            },
            { 
                question: 'What does len() return?', 
                answer: 'Number of items',
                explanation: 'len(list) returns the number of items in the list'
            },
            { 
                question: 'What is a list slice [1:3]?', 
                answer: 'Items at index 1 and 2',
                explanation: 'Slicing [start:end] includes start but excludes end index'
            },
            { 
                question: 'What does range(5) create?', 
                answer: 'Numbers 0 through 4',
                explanation: 'range(n) creates numbers from 0 to n-1'
            },
            { 
                question: 'What is the and operator?', 
                answer: 'Both conditions must be True',
                explanation: 'True and True returns True. Any False makes result False.'
            },
            { 
                question: 'What is the or operator?', 
                answer: 'At least one condition must be True',
                explanation: 'True or False returns True. Only False or False is False.'
            },
            { 
                question: 'What does not do?', 
                answer: 'Reverses boolean value',
                explanation: 'not True returns False, not False returns True'
            },
            { 
                question: 'What does try-except do?', 
                answer: 'Handles errors gracefully',
                explanation: 'try runs code, except catches errors to prevent crashes'
            },
            { 
                question: 'What does finally do?', 
                answer: 'Always runs after try-except',
                explanation: 'finally block executes regardless of whether error occurred'
            },
            { 
                question: 'What does open() do?', 
                answer: 'Opens a file',
                explanation: 'open(filename, mode) opens a file for reading/writing'
            },
            { 
                question: 'What is "with" statement for?', 
                answer: 'Auto-closes file',
                explanation: 'with open() automatically closes file when done'
            },
            { 
                question: 'What does import do?', 
                answer: 'Loads a module',
                explanation: 'import module_name brings in external Python code'
            }
        ];

        const matchingPairs = [
            { term: 'int()', definition: 'Convert to integer' },
            { term: 'str()', definition: 'Convert to string' },
            { term: '==', definition: 'Check equality' },
            { term: '//', definition: 'Floor division' },
            { term: '%', definition: 'Modulus (remainder)' },
            { term: 'append()', definition: 'Add to end of list' },
            { term: 'and', definition: 'Both must be True' },
            { term: 'try-except', definition: 'Handle errors' }
        ];

        const speedQuizQuestions = [
            {
                question: 'What does 5 / 2 return in Python 3?',
                options: ['2', '2.5', '3'],
                correct: 1
            },
            {
                question: 'What does 5 // 2 return?',
                options: ['2', '2.5', '1'],
                correct: 0
            },
            {
                question: 'What does 5 % 2 return?',
                options: ['1', '2', '0'],
                correct: 0
            },
            {
                question: 'What does int("10") return?',
                options: ['10 (integer)', '"10" (string)', 'Error'],
                correct: 0
            },
            {
                question: 'What does str(5) + str(3) return?',
                options: ['8', '"53"', 'Error'],
                correct: 1
            },
            {
                question: 'What does True and False return?',
                options: ['True', 'False', 'Error'],
                correct: 1
            },
            {
                question: 'What does True or False return?',
                options: ['True', 'False', 'Error'],
                correct: 0
            },
            {
                question: 'What does not True return?',
                options: ['True', 'False', 'Error'],
                correct: 1
            },
            {
                question: 'How do you add item to end of list?',
                options: ['list.add()', 'list.append()', 'list.insert()'],
                correct: 1
            },
            {
                question: 'What does len([1,2,3]) return?',
                options: ['2', '3', '6'],
                correct: 1
            }
        ];

        const codeChallenges = [
            {
                question: 'What will this print?',
                code: 'x = "5"\ny = 3\nprint(int(x) + y)',
                options: ['8', '"53"', 'Error'],
                correct: 0,
                explanation: 'int("5") converts string to integer 5, then 5 + 3 = 8'
            },
            {
                question: 'What will this print?',
                code: 'fruits = ["apple", "banana"]\nfruits.append("cherry")\nprint(len(fruits))',
                options: ['2', '3', 'Error'],
                correct: 1,
                explanation: 'After appending, the list has 3 items'
            },
            {
                question: 'What will this print?',
                code: 'print(10 % 3)',
                options: ['1', '3', '0'],
                correct: 0,
                explanation: '10 divided by 3 is 3 remainder 1. Modulus returns the remainder.'
            },
            {
                question: 'What will this print?',
                code: 'score = 85\nif score >= 80:\n    print("B")\nelse:\n    print("C")',
                options: ['B', 'C', 'Error'],
                correct: 0,
                explanation: 'Since 85 >= 80 is True, it prints "B"'
            },
            {
                question: 'What will this print?',
                code: 'numbers = [1, 2, 3, 4]\nprint(numbers[1:3])',
                options: ['[1, 2]', '[2, 3]', '[1, 2, 3]'],
                correct: 1,
                explanation: 'Slice [1:3] includes index 1 and 2, but not 3'
            },
            {
                question: 'What will this print?',
                code: 'x = 5\ny = 10\nprint(x == y)',
                options: ['True', 'False', '5'],
                correct: 1,
                explanation: '5 does not equal 10, so comparison returns False'
            },
            {
                question: 'What will this print?',
                code: 'for i in range(3):\n    print(i)',
                options: ['0 1 2', '1 2 3', '0 1 2 3'],
                correct: 0,
                explanation: 'range(3) generates 0, 1, 2 (not including 3)'
            },
            {
                question: 'What will this print?',
                code: 'word = "Python"\nprint(word[0] + word[-1])',
                options: ['Pn', 'Py', 'ython'],
                correct: 0,
                explanation: 'word[0] is "P", word[-1] is "n", concatenated = "Pn"'
            },
            {
                question: 'What will this print?',
                code: 'nums = [5, 2, 8, 1]\nnums.sort()\nprint(nums[0])',
                options: ['1', '5', '8'],
                correct: 0,
                explanation: 'After sorting, nums = [1, 2, 5, 8], so nums[0] = 1'
            },
            {
                question: 'What will this print?',
                code: 'print(bool(""))',
                options: ['True', 'False', 'Error'],
                correct: 1,
                explanation: 'Empty string is falsy, so bool("") returns False'
            }
        ];

        const fillBlankChallenges = [
            {
                question: 'Convert a string to an integer',
                code: 'age = ___("25")',
                answer: 'int',
                explanation: 'Use int() to convert string to integer'
            },
            {
                question: 'Add item to end of list',
                code: 'fruits = ["apple"]\nfruits.___()"banana")',
                answer: 'append',
                explanation: 'Use append() method to add to end of list'
            },
            {
                question: 'Check if both conditions are true',
                code: 'if x > 5 ___ y < 10:\n    print("Yes")',
                answer: 'and',
                explanation: 'Use "and" when both conditions must be True'
            },
            {
                question: 'Handle an error',
                code: '___:\n    x = int(input())\n___:\n    print("Invalid")',
                answer: 'try',
                explanation: 'Use try-except to handle potential errors'
            },
            {
                question: 'Get remainder after division',
                code: 'remainder = 10 ___ 3',
                answer: '%',
                explanation: 'Use % (modulus) operator for remainder'
            }
        ];

        // Initialize games
        function startGame(gameName) {
            document.getElementById('game-menu').style.display = 'none';
            document.querySelectorAll('.game-area').forEach(area => {
                area.classList.remove('active');
                area.style.display = 'none';
            });
            
            const gameArea = document.getElementById(`${gameName}-game`);
            gameArea.style.display = ''; // Remove inline style so CSS can work
            gameArea.classList.add('active');
            currentGame = gameName;
            
            // Initialize specific game
            switch(gameName) {
                case 'wordle':
                    newWordleGame();
                    break;
                case 'flashcards':
                    initFlashcards();
                    break;
                case 'matching':
                    initMatchingGame();
                    break;
                case 'speed-quiz':
                    // Quiz starts when user clicks start button
                    break;
                case 'code-challenge':
                    initCodeChallenges();
                    break;
                case 'fill-blank':
                    initFillBlanks();
                    break;
                case 'dice-roll':
                    startDiceRoll();
                    break;
                case 'bug-hunter':
                    startBugHunter();
                    break;
                case 'battle-quiz':
                    // Battle starts when user clicks start button
                    break;
            }
        }

        function backToMenu() {
            document.querySelectorAll('.game-area').forEach(area => {
                area.classList.remove('active');
                area.style.display = 'none';
            });
            document.getElementById('game-menu').style.display = 'grid';
            currentGame = null;
            
            // Clear any timers
            if (speedQuizTimer) {
                clearInterval(speedQuizTimer);
                speedQuizTimer = null;
            }
        }

        // Wordle Game
        function newWordleGame() {
            const wordData = wordleWords[Math.floor(Math.random() * wordleWords.length)];
            currentWordleWord = wordData.word;
            currentWordleAttempt = 0;
            
            document.getElementById('wordle-hint').textContent = `üí° Hint: ${wordData.hint}`;
            
            // Create grid
            const grid = document.getElementById('wordle-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('div');
                row.className = 'wordle-row';
                row.id = `wordle-row-${i}`;
                
                for (let j = 0; j < currentWordleWord.length; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'wordle-cell';
                    cell.id = `cell-${i}-${j}`;
                    row.appendChild(cell);
                }
                grid.appendChild(row);
            }
            
            // Create keyboard
            createKeyboard();
        }

        function createKeyboard() {
            const keyboard = document.getElementById('keyboard');
            keyboard.innerHTML = '';
            
            const rows = [
                ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                ['ENTER', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', '‚å´']
            ];
            
            rows.forEach((row, rowIndex) => {
                row.forEach(key => {
                    const button = document.createElement('button');
                    button.className = 'key';
                    button.textContent = key;
                    
                    if (key === 'ENTER' || key === '‚å´') {
                        button.classList.add('wide');
                    }
                    
                    button.onclick = () => handleKeyPress(key);
                    keyboard.appendChild(button);
                });
            });
        }

        let currentGuess = '';

        function handleKeyPress(key) {
            if (currentWordleAttempt >= 6) return;
            
            if (key === 'ENTER') {
                if (currentGuess.length === currentWordleWord.length) {
                    submitGuess();
                }
            } else if (key === '‚å´') {
                currentGuess = currentGuess.slice(0, -1);
                updateCurrentRow();
            } else if (currentGuess.length < currentWordleWord.length) {
                currentGuess += key;
                updateCurrentRow();
            }
        }

        function updateCurrentRow() {
            const row = document.getElementById(`wordle-row-${currentWordleAttempt}`);
            const cells = row.querySelectorAll('.wordle-cell');
            
            cells.forEach((cell, index) => {
                cell.textContent = currentGuess[index] || '';
                if (currentGuess[index]) {
                    cell.classList.add('filled');
                } else {
                    cell.classList.remove('filled');
                }
            });
        }

        function submitGuess() {
            const row = document.getElementById(`wordle-row-${currentWordleAttempt}`);
            const cells = row.querySelectorAll('.wordle-cell');
            
            // Check each letter
            let correct = true;
            const letterCount = {};
            
            // Count letters in target word
            for (let char of currentWordleWord) {
                letterCount[char] = (letterCount[char] || 0) + 1;
            }
            
            // First pass: mark correct positions
            cells.forEach((cell, index) => {
                const letter = currentGuess[index];
                if (letter === currentWordleWord[index]) {
                    cell.classList.add('correct');
                    letterCount[letter]--;
                } else {
                    correct = false;
                }
            });
            
            // Second pass: mark present letters
            cells.forEach((cell, index) => {
                const letter = currentGuess[index];
                if (!cell.classList.contains('correct')) {
                    if (currentWordleWord.includes(letter) && letterCount[letter] > 0) {
                        cell.classList.add('present');
                        letterCount[letter]--;
                    } else {
                        cell.classList.add('absent');
                    }
                }
                
                // Update keyboard
                const key = document.querySelector(`.key:not(.wide)`);
                updateKeyboard(letter, cell.classList);
            });
            
            if (correct) {
                wordleStreak++;
                document.getElementById('wordle-streak').textContent = wordleStreak;
                setTimeout(() => {
                    alert(`üéâ Correct! The word was ${currentWordleWord}\nStreak: ${wordleStreak}`);
                    newWordleGame();
                }, 500);
            } else if (currentWordleAttempt === 5) {
                wordleStreak = 0;
                document.getElementById('wordle-streak').textContent = wordleStreak;
                setTimeout(() => {
                    alert(`Game Over! The word was ${currentWordleWord}`);
                    newWordleGame();
                }, 500);
            }
            
            currentWordleAttempt++;
            currentGuess = '';
        }

        function updateKeyboard(letter, classList) {
            const keys = document.querySelectorAll('.key');
            keys.forEach(key => {
                if (key.textContent === letter) {
                    if (classList.contains('correct')) {
                        key.classList.add('correct');
                    } else if (classList.contains('present') && !key.classList.contains('correct')) {
                        key.classList.add('present');
                    } else if (classList.contains('absent') && !key.classList.contains('correct') && !key.classList.contains('present')) {
                        key.classList.add('absent');
                    }
                }
            });
        }

        // Flashcards
        function initFlashcards() {
            currentCardIndex = 0;
            document.getElementById('total-cards').textContent = flashcards.length;
            loadFlashcard();
        }

        function loadFlashcard() {
            const card = flashcards[currentCardIndex];
            document.getElementById('current-card').textContent = currentCardIndex + 1;
            document.getElementById('question-text').textContent = card.question;
            document.getElementById('answer-text').textContent = card.answer;
            document.getElementById('explanation-text').textContent = card.explanation;
            
            // Reset flip
            document.getElementById('flashcard').classList.remove('flipped');
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function nextCard() {
            if (currentCardIndex < flashcards.length - 1) {
                currentCardIndex++;
                loadFlashcard();
            } else {
                alert('üéâ You\'ve reviewed all flashcards! Great job!');
                currentCardIndex = 0;
                loadFlashcard();
            }
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                loadFlashcard();
            }
        }

        // Matching Game
        function initMatchingGame() {
            matchingSelected = [];
            matchingMatches = 0;
            matchingMoves = 0;
            
            document.getElementById('matches-count').textContent = matchingMatches;
            document.getElementById('total-matches').textContent = matchingPairs.length;
            document.getElementById('moves-count').textContent = matchingMoves;
            
            const grid = document.getElementById('matching-grid');
            grid.innerHTML = '';
            
            // Create shuffled array of terms and definitions
            const items = [];
            matchingPairs.forEach((pair, index) => {
                items.push({ text: pair.term, type: 'term', pairIndex: index });
                items.push({ text: pair.definition, type: 'definition', pairIndex: index });
            });
            
            // Shuffle
            items.sort(() => Math.random() - 0.5);
            
            // Create cards
            items.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'matching-card';
                card.textContent = item.text;
                card.dataset.type = item.type;
                card.dataset.pair = item.pairIndex;
                card.dataset.index = index;
                card.onclick = () => selectMatchingCard(card);
                grid.appendChild(card);
            });
        }

        function selectMatchingCard(card) {
            if (card.classList.contains('matched') || matchingSelected.includes(card)) return;
            
            card.classList.add('selected');
            matchingSelected.push(card);
            
            if (matchingSelected.length === 2) {
                matchingMoves++;
                document.getElementById('moves-count').textContent = matchingMoves;
                
                setTimeout(() => {
                    checkMatch();
                }, 500);
            }
        }

        function checkMatch() {
            const [card1, card2] = matchingSelected;
            
            if (card1.dataset.pair === card2.dataset.pair && card1.dataset.type !== card2.dataset.type) {
                // Match!
                card1.classList.remove('selected');
                card2.classList.remove('selected');
                card1.classList.add('matched');
                card2.classList.add('matched');
                
                matchingMatches++;
                document.getElementById('matches-count').textContent = matchingMatches;
                
                if (matchingMatches === matchingPairs.length) {
                    setTimeout(() => {
                        alert(`üéâ Congratulations! You matched all pairs in ${matchingMoves} moves!`);
                    }, 500);
                }
            } else {
                // No match
                card1.classList.add('wrong');
                card2.classList.add('wrong');
                
                setTimeout(() => {
                    card1.classList.remove('selected', 'wrong');
                    card2.classList.remove('selected', 'wrong');
                }, 800);
            }
            
            matchingSelected = [];
        }

        function resetMatchingGame() {
            initMatchingGame();
        }

        // Speed Quiz
        function startSpeedQuiz() {
            speedQuizScore = 0;
            speedQuizTotal = 0;
            let timeLeft = 60;
            let currentQuestion = 0;
            
            document.getElementById('quiz-score').textContent = speedQuizScore;
            document.getElementById('quiz-total').textContent = speedQuizTotal;
            document.getElementById('timer').textContent = timeLeft;
            
            // Shuffle questions
            const questions = [...speedQuizQuestions].sort(() => Math.random() - 0.5);
            
            function loadQuestion() {
                if (currentQuestion >= questions.length) {
                    currentQuestion = 0;
                }
                
                const q = questions[currentQuestion];
                const container = document.getElementById('speed-quiz-container');
                
                container.innerHTML = `
                    <div class="quiz-question">
                        <h3>${q.question}</h3>
                        <div class="quiz-options" id="quiz-options">
                            ${q.options.map((opt, i) => `
                                <div class="quiz-option" onclick="answerSpeedQuiz(${i}, ${q.correct}, ${currentQuestion})">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                currentQuestion++;
            }
            
            loadQuestion();
            
            // Start timer
            if (speedQuizTimer) clearInterval(speedQuizTimer);
            speedQuizTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(speedQuizTimer);
                    alert(`Time's up! Final Score: ${speedQuizScore} / ${speedQuizTotal}`);
                }
            }, 1000);
            
            window.loadNextSpeedQuestion = loadQuestion;
        }

        function answerSpeedQuiz(selected, correct, questionNum) {
            const options = document.querySelectorAll('#quiz-options .quiz-option');
            speedQuizTotal++;
            
            if (selected === correct) {
                speedQuizScore++;
                options[selected].classList.add('correct');
            } else {
                options[selected].classList.add('incorrect');
                options[correct].classList.add('correct');
            }
            
            document.getElementById('quiz-score').textContent = speedQuizScore;
            document.getElementById('quiz-total').textContent = speedQuizTotal;
            
            const progress = (speedQuizScore / speedQuizTotal) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            
            setTimeout(() => {
                window.loadNextSpeedQuestion();
            }, 1000);
        }

        // Code Challenges
        function initCodeChallenges() {
            currentChallengeIndex = 0;
            loadChallenge();
        }

        function loadChallenge() {
            const challenge = codeChallenges[currentChallengeIndex];
            const container = document.getElementById('code-challenge-container');
            
            document.getElementById('challenge-num').textContent = currentChallengeIndex + 1;
            
            container.innerHTML = `
                <div class="quiz-question">
                    <h3>${challenge.question}</h3>
                    <div class="code-block">${highlightPython(challenge.code)}</div>
                    <div class="quiz-options" id="challenge-options">
                        ${challenge.options.map((opt, i) => `
                            <div class="quiz-option" onclick="answerChallenge(${i}, ${challenge.correct})">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div id="challenge-feedback"></div>
                </div>
            `;
        }

        function answerChallenge(selected, correct) {
            const options = document.querySelectorAll('#challenge-options .quiz-option');
            const feedback = document.getElementById('challenge-feedback');
            const challenge = codeChallenges[currentChallengeIndex];
            
            if (selected === correct) {
                options[selected].classList.add('correct');
                feedback.innerHTML = `<div class="success-message">‚úÖ Correct! ${challenge.explanation}</div>`;
            } else {
                options[selected].classList.add('incorrect');
                options[correct].classList.add('correct');
                feedback.innerHTML = `<div class="hint-box">‚ùå Not quite. ${challenge.explanation}</div>`;
            }
        }

        function nextChallenge() {
            currentChallengeIndex = (currentChallengeIndex + 1) % codeChallenges.length;
            loadChallenge();
        }

        // Fill the Blanks
        function initFillBlanks() {
            currentBlankIndex = 0;
            loadBlankChallenge();
        }

        function loadBlankChallenge() {
            const challenge = fillBlankChallenges[currentBlankIndex];
            const container = document.getElementById('fill-blank-container');
            
            document.getElementById('blank-progress').textContent = currentBlankIndex + 1;
            
            container.innerHTML = `
                <div class="quiz-question">
                    <h3>${challenge.question}</h3>
                    <div class="code-block">${highlightPython(challenge.code)}</div>
                    <div style="margin: 20px 0;">
                        <label style="font-size: 1.2em; color: #667eea; margin-right: 10px;">Your answer:</label>
                        <input type="text" id="blank-input" 
                               style="padding: 10px; font-size: 1.1em; border: 2px solid #dee2e6; border-radius: 5px; width: 200px;"
                               placeholder="Type here...">
                    </div>
                    <div id="blank-feedback"></div>
                    <div class="hint-box">üí° ${challenge.explanation}</div>
                </div>
            `;
            
            document.getElementById('blank-input').focus();
        }

        function checkBlanks() {
            const challenge = fillBlankChallenges[currentBlankIndex];
            const input = document.getElementById('blank-input').value.trim().toLowerCase();
            const feedback = document.getElementById('blank-feedback');
            
            if (input === challenge.answer.toLowerCase()) {
                feedback.innerHTML = '<div class="success-message">‚úÖ Correct!</div>';
            } else {
                feedback.innerHTML = `<div class="hint-box">‚ùå Not quite. The answer is: <strong>${challenge.answer}</strong></div>`;
            }
        }

        function nextBlankChallenge() {
            currentBlankIndex = (currentBlankIndex + 1) % fillBlankChallenges.length;
            loadBlankChallenge();
        }

        function escapeHtml(text) {
            return text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function highlightPython(code) {
            // Python keywords
            const keywords = ['def', 'class', 'import', 'from', 'if', 'elif', 'else', 'for', 'while', 
                            'try', 'except', 'finally', 'with', 'as', 'return', 'break', 'continue', 
                            'pass', 'raise', 'in', 'not', 'and', 'or', 'is', 'True', 'False', 'None'];
            
            // Functions that are commonly used
            const functions = ['print', 'len', 'range', 'int', 'str', 'float', 'bool', 'list', 'dict', 
                             'input', 'open', 'append', 'pop', 'sort', 'sorted'];
            
            let highlighted = escapeHtml(code);
            
            // Highlight strings (both single and double quotes)
            highlighted = highlighted.replace(/(&quot;[^&quot;]*&quot;|'[^']*')/g, '<span class="string">$1</span>');
            
            // Highlight comments
            highlighted = highlighted.replace(/(#.*$)/gm, '<span class="comment">$1</span>');
            
            // Highlight numbers
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
            
            // Highlight keywords
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
            });
            
            // Highlight common functions
            functions.forEach(func => {
                const regex = new RegExp(`\\b(${func})(?=\\()`, 'g');
                highlighted = highlighted.replace(regex, '<span class="function">$1</span>');
            });
            
            return highlighted;
        }

        // Keyboard support for Wordle
        document.addEventListener('keydown', (e) => {
            if (currentGame === 'wordle') {
                if (e.key === 'Enter') {
                    handleKeyPress('ENTER');
                } else if (e.key === 'Backspace') {
                    handleKeyPress('‚å´');
                } else if (/^[a-zA-Z]$/.test(e.key)) {
                    handleKeyPress(e.key.toUpperCase());
                }
            }
        });

        // ========== LEADERBOARD SYSTEM ==========
        async function saveScore(playerName, game, score, userId = null, photoURL = null) {
            try {
                const db = window.firebaseDb;
                const leaderboardRef = window.firestoreCollection(db, 'pythonGamesLeaderboard');
                
                // Check if user already has a score for this game
                const q = window.firestoreQuery(leaderboardRef, 
                    window.firestoreWhere('userId', '==', userId), 
                    window.firestoreWhere('game', '==', game)
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                if (!querySnapshot.empty) {
                    // Update existing score only if new score is higher
                    const existingDoc = querySnapshot.docs[0];
                    const existingData = existingDoc.data();
                    
                    if (score > existingData.score) {
                        await window.firestoreUpdateDoc(window.firestoreDoc(db, 'pythonGamesLeaderboard', existingDoc.id), {
                            score: score,
                            timestamp: window.firestoreServerTimestamp()
                        });
                    }
                } else {
                    // Add new score entry
                    await window.firestoreAddDoc(leaderboardRef, {
                        name: playerName,
                        game: game,
                        score: score,
                        userId: userId,
                        photoURL: photoURL,
                        timestamp: window.firestoreServerTimestamp()
                    });
                }
            } catch (error) {
                console.error('Error saving score:', error);
                showCustomAlert('Failed to save score. Please try again.', 'Error', '‚ùå', 'error');
            }
        }

        function showLeaderboard() {
            currentGame = 'leaderboard';
            document.getElementById('game-menu').style.display = 'none';
            const leaderboardArea = document.getElementById('leaderboard-area');
            leaderboardArea.style.display = ''; // Remove inline style
            leaderboardArea.classList.add('active');
            displayLeaderboard();
        }

        async function displayLeaderboard() {
            const filter = document.getElementById('filter-game').value;
            const listDiv = document.getElementById('leaderboard-list');
            
            // Show loading state
            listDiv.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 2em;">‚è≥</div><p>Loading leaderboard...</p></div>';
            
            let leaderboard = [];
            
            try {
                const db = window.firebaseDb;
                const leaderboardRef = window.firestoreCollection(db, 'pythonGamesLeaderboard');
                
                // Build query based on filter (without orderBy to avoid index requirement)
                let q;
                if (filter !== 'all') {
                    q = window.firestoreQuery(leaderboardRef, window.firestoreWhere('game', '==', filter));
                } else {
                    q = leaderboardRef;
                }
                
                const querySnapshot = await window.firestoreGetDocs(q);
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    leaderboard.push({
                        ...data,
                        timestamp: data.timestamp?.toDate().toISOString()
                    });
                });
                
                // Sort by score in JavaScript (highest first)
                leaderboard.sort((a, b) => b.score - a.score);
                
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                listDiv.innerHTML = '<div style="text-align: center; padding: 40px; color: #f85149;"><div style="font-size: 2em;">‚ùå</div><p>Failed to load leaderboard. Please try again.</p></div>';
                return;
            }
            
            if (leaderboard.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-leaderboard">
                        <div class="icon">üéÆ</div>
                        <p>No scores yet! Be the first to make it on the leaderboard!</p>
                        <button class="btn btn-primary" onclick="backToMenu()" style="padding: 12px 30px; font-size: 1em;">Start Playing</button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            leaderboard.slice(0, 10).forEach((entry, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                const rankNumber = index + 1;
                
                const gameInfo = {
                    'wordle': { name: 'Code Wordle', icon: 'üî§' },
                    'flashcards': { name: 'Smart Flashcards', icon: 'üé¥' },
                    'matching': { name: 'Match Master', icon: 'üéØ' },
                    'speed-quiz': { name: 'Speed Quiz', icon: '‚ö°' },
                    'code-challenge': { name: 'Code Challenges', icon: 'üíª' },
                    'fill-blank': { name: 'Fill the Blanks', icon: 'üìù' },
                    'dice-roll': { name: 'Dice Roll', icon: 'üé≤' },
                    'bug-hunter': { name: 'Bug Hunter', icon: 'üîç' },
                    'battle-quiz': { name: 'Battle Quiz', icon: '‚öîÔ∏è' }
                };
                
                const game = gameInfo[entry.game] || { name: entry.game, icon: 'üéÆ' };
                
                // Format timestamp
                let timeAgo = '';
                if (entry.timestamp) {
                    const date = new Date(entry.timestamp);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    if (diffMins < 1) {
                        timeAgo = 'Just now';
                    } else if (diffMins < 60) {
                        timeAgo = `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
                    } else if (diffHours < 24) {
                        timeAgo = `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
                    } else if (diffDays < 7) {
                        timeAgo = `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
                    } else {
                        timeAgo = date.toLocaleDateString();
                    }
                }
                
                const userPhoto = entry.photoURL 
                    ? `<img src="${entry.photoURL}" alt="${entry.name}" style="width: 24px; height: 24px; border-radius: 50%; margin-right: 8px; vertical-align: middle;">` 
                    : 'üë§ ';
                
                html += `
                    <div class="leaderboard-entry ${rankClass}" style="animation-delay: ${index * 0.05}s">
                        <div class="leaderboard-rank">${medal || rankNumber}</div>
                        <div class="leaderboard-player">
                            <div class="name">
                                ${userPhoto}${entry.name}
                                ${index < 3 ? '<span style="margin-left: 8px; font-size: 0.8em;">üëë</span>' : ''}
                            </div>
                            <div class="game">
                                <span class="game-icon">${game.icon}</span>
                                ${game.name}
                            </div>
                            ${timeAgo ? `<div class="timestamp">‚è∞ ${timeAgo}</div>` : ''}
                        </div>
                        <div class="leaderboard-score">
                            ${entry.score}
                            <div style="font-size: 0.5em; color: #999; font-weight: normal; margin-top: 2px;">POINTS</div>
                        </div>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }



        async function promptPlayerName(game, score) {
            // Check if user is signed in
            if (!window.currentUser) {
                const confirmed = await showCustomConfirm(
                    `You scored <strong>${score} points</strong>!<br><br>Sign in with Google to save your score to the leaderboard.`,
                    'Great Score!',
                    'üèÜ'
                );
                
                if (confirmed) {
                    const user = await window.signInWithGoogle();
                    if (user) {
                        const playerName = user.displayName || user.email.split('@')[0];
                        saveScore(playerName, game, score, user.uid, user.photoURL);
                        showCustomAlert(
                            'Check the leaderboard to see your ranking!',
                            'Score Saved!',
                            '‚úì',
                            'success'
                        );
                    }
                }
            } else {
                const playerName = window.currentUser.displayName || window.currentUser.email.split('@')[0];
                saveScore(playerName, game, score, window.currentUser.uid, window.currentUser.photoURL);
                showCustomAlert(
                    'Check the leaderboard to see your ranking!',
                    'Score Saved!',
                    '‚úì',
                    'success'
                );
            }
        }

        // ========== DICE ROLL GAME ==========
        let diceScore = 0;
        let diceRolls = 0;
        const maxDiceRolls = 10;

        const diceQuestions = {
            1: [
                { question: 'What does print() do?', options: ['Display output', 'Get input', 'Calculate', 'Store data'], answer: 0 },
                { question: 'What is 5 + 3?', options: ['7', '8', '9', '10'], answer: 1 }
            ],
            2: [
                { question: 'What does int() do?', options: ['Convert to string', 'Convert to integer', 'Convert to float', 'Print value'], answer: 1 },
                { question: 'What is the modulus operator?', options: ['/', '*', '%', '**'], answer: 2 }
            ],
            3: [
                { question: 'How do you create a list?', options: ['()', '{}', '[]', '<>'], answer: 2 },
                { question: 'What does len() return?', options: ['First item', 'Last item', 'Number of items', 'All items'], answer: 2 }
            ],
            4: [
                { question: 'What keyword starts a function?', options: ['func', 'define', 'def', 'function'], answer: 2 },
                { question: 'How do you add to a list?', options: ['add()', 'append()', 'insert()', 'push()'], answer: 1 }
            ],
            5: [
                { question: 'What is a while loop?', options: ['Runs once', 'Runs forever', 'Runs while condition is true', 'Never runs'], answer: 2 },
                { question: 'What does // do?', options: ['Float division', 'Floor division', 'Modulus', 'Exponent'], answer: 1 }
            ],
            6: [
                { question: 'What is a dictionary key-value separator?', options: ['=', ':', '->', '=>'], answer: 1 },
                { question: 'What handles errors in Python?', options: ['if-else', 'try-except', 'catch-throw', 'error-handle'], answer: 1 }
            ]
        };

        function startDiceRoll() {
            diceScore = 0;
            diceRolls = 0;
            document.getElementById('dice-score').textContent = diceScore;
            document.getElementById('dice-result').textContent = '';
            document.getElementById('dice-question-container').innerHTML = '';
            document.getElementById('dice').textContent = 'üé≤';
        }

        function rollDice() {
            if (diceRolls >= maxDiceRolls) {
                showCustomAlert(
                    'Submit your score to the leaderboard!',
                    'Game Over!',
                    'üé≤',
                    'info'
                );
                return;
            }

            const dice = document.getElementById('dice');
            dice.classList.add('rolling');
            
            setTimeout(() => {
                const roll = Math.floor(Math.random() * 6) + 1;
                dice.textContent = roll;
                dice.classList.remove('rolling');
                
                const points = roll * 10;
                document.getElementById('dice-result').textContent = `You rolled a ${roll}! Answer correctly for ${points} points!`;
                
                showDiceQuestion(roll, points);
                diceRolls++;
            }, 500);
        }

        function showDiceQuestion(roll, points) {
            const questions = diceQuestions[roll];
            const q = questions[Math.floor(Math.random() * questions.length)];
            
            let html = `
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px auto; max-width: 600px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px;">${q.question}</h3>
            `;
            
            q.options.forEach((opt, i) => {
                html += `
                    <button class="btn btn-secondary" onclick="checkDiceAnswer(${i}, ${q.answer}, ${points})" style="display: block; width: 100%; margin: 10px 0;">
                        ${opt}
                    </button>
                `;
            });
            
            html += '</div>';
            document.getElementById('dice-question-container').innerHTML = html;
        }

        function checkDiceAnswer(selected, correct, points) {
            if (selected === correct) {
                diceScore += points;
                showCustomAlert(
                    `+${points} points!`,
                    'Correct!',
                    '‚úÖ',
                    'success'
                );
            } else {
                showCustomAlert(
                    'No points this round.',
                    'Wrong Answer',
                    '‚ùå',
                    'error'
                );
            }
            
            document.getElementById('dice-score').textContent = diceScore;
            document.getElementById('dice-question-container').innerHTML = '';
            document.getElementById('dice-result').textContent = `Score: ${diceScore} | Rolls left: ${maxDiceRolls - diceRolls}`;
            
            if (diceRolls >= maxDiceRolls) {
                document.getElementById('dice-result').textContent = `üéâ Game Over! Final Score: ${diceScore}`;
            }
        }

        function submitDiceScore() {
            if (diceScore > 0) {
                promptPlayerName('dice-roll', diceScore);
            } else {
                showCustomAlert(
                    'Play the game first to get a score!',
                    'No Score Yet',
                    '‚ÑπÔ∏è',
                    'info'
                );
            }
        }

        // ========== BUG HUNTER GAME ==========
        let bugScore = 0;
        let bugsFound = 0;
        let bugChallenges = [];

        const bugData = [
            {
                code: `def calculate_sum(a, b)
    return a + b`,
                bugs: [{ line: 0, fix: 'Missing colon after function definition', fixed: `def calculate_sum(a, b):` }],
                explanation: 'Function definitions must end with a colon (:)'
            },
            {
                code: `numbers = [1, 2, 3, 4, 5]
for i in range(len(numbers))
    print(numbers[i])`,
                bugs: [{ line: 1, fix: 'Missing colon after for loop', fixed: `for i in range(len(numbers)):` }],
                explanation: 'For loops must end with a colon (:)'
            },
            {
                code: `x = 5
if x = 10:
    print("Equal")`,
                bugs: [{ line: 1, fix: 'Use == for comparison, not =', fixed: `if x == 10:` }],
                explanation: 'Use == for comparison, = is for assignment'
            },
            {
                code: `def greet(name):
print("Hello " + name)`,
                bugs: [{ line: 1, fix: 'Indentation error - print should be indented', fixed: `    print("Hello " + name)` }],
                explanation: 'Code inside functions must be indented'
            },
            {
                code: `my_list = [1, 2, 3]
print(my_list[3])`,
                bugs: [{ line: 1, fix: 'Index out of range - list has indices 0-2', fixed: `print(my_list[2])` }],
                explanation: 'Lists use zero-based indexing. my_list[3] doesn\'t exist'
            }
        ];

        function startBugHunter() {
            bugScore = 0;
            bugsFound = 0;
            bugChallenges = [...bugData];
            document.getElementById('bugs-found').textContent = bugsFound;
            document.getElementById('total-bugs').textContent = bugChallenges.length;
            document.getElementById('bug-score').textContent = bugScore;
            showBugChallenge();
        }

        function showBugChallenge() {
            if (bugChallenges.length === 0) {
                document.getElementById('bug-container').innerHTML = `
                    <div style="text-align: center; padding: 40px; background: white; border-radius: 15px; margin: 20px 0;">
                        <h2 style="color: #28a745;">üéâ All Bugs Found!</h2>
                        <p style="font-size: 1.3em; color: #667eea;">Final Score: ${bugScore} points</p>
                        <p>Submit your score to the leaderboard!</p>
                    </div>
                `;
                return;
            }

            const challenge = bugChallenges[0];
            const lines = challenge.code.split('\n');
            
            let html = `
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #dc3545; margin-bottom: 15px;">üêõ Find and Fix the Bug!</h3>
                    <div class="bug-code">
            `;
            
            lines.forEach((line, index) => {
                // Just escape HTML, don't apply syntax highlighting to avoid nested span issues
                const escapedLine = escapeHtml(line) || '&nbsp;';
                
                html += `<div onclick="findBug(${index})" style="cursor: pointer; padding: 5px; border-radius: 3px; margin: 2px 0;" onmouseover="this.style.background='#fff3cd'" onmouseout="this.style.background='transparent'">${escapedLine}</div>`;
            });
            
            html += `
                    </div>
                    <p style="margin-top: 15px; color: #555;"><strong>Hint:</strong> ${challenge.explanation}</p>
                </div>
            `;
            
            document.getElementById('bug-container').innerHTML = html;
        }

        function findBug(lineIndex) {
            const challenge = bugChallenges[0];
            const bug = challenge.bugs.find(b => b.line === lineIndex);
            
            if (bug) {
                bugScore += 50;
                bugsFound++;
                document.getElementById('bugs-found').textContent = bugsFound;
                document.getElementById('bug-score').textContent = bugScore;
                
                showCustomAlert(
                    `<strong>+50 points!</strong><br><br><strong>Fix:</strong> ${bug.fix}<br><br><strong>Correct code:</strong><br><code style="background: #f0f0f0; padding: 5px; border-radius: 3px; display: block; margin-top: 10px;">${bug.fixed}</code>`,
                    'Bug Found!',
                    '‚úÖ',
                    'success'
                ).then(() => {
                    bugChallenges.shift();
                    showBugChallenge();
                });
            } else {
                showCustomAlert(
                    'Keep looking!',
                    'No Bug Here',
                    '‚ùå',
                    'error'
                );
            }
        }

        function submitBugScore() {
            if (bugScore > 0) {
                promptPlayerName('bug-hunter', bugScore);
            } else {
                showCustomAlert(
                    'Find some bugs first to get a score!',
                    'No Score Yet',
                    '‚ÑπÔ∏è',
                    'info'
                );
            }
        }

        // ========== BATTLE QUIZ GAME ==========
        let playerHealth = 100;
        let aiHealth = 100;
        let battleScore = 0;
        let battleQuestionIndex = 0;

        const battleQuestions = [
            { question: 'What does print() do?', options: ['Display output', 'Get input', 'Calculate', 'Delete'], answer: 0 },
            { question: 'What is 10 % 3?', options: ['0', '1', '2', '3'], answer: 1 },
            { question: 'How do you create a function?', options: ['func name():', 'def name():', 'function name():', 'define name():'], answer: 1 },
            { question: 'What does len() return?', options: ['First item', 'Last item', 'Number of items', 'Sum'], answer: 2 },
            { question: 'Which is a comparison operator?', options: ['=', '==', '===', ':='], answer: 1 },
            { question: 'What does append() do?', options: ['Remove item', 'Add to start', 'Add to end', 'Sort list'], answer: 2 },
            { question: 'What is a while loop?', options: ['Runs once', 'Runs forever', 'Runs while true', 'Never runs'], answer: 2 },
            { question: 'What does int() do?', options: ['Make string', 'Make integer', 'Make float', 'Make list'], answer: 1 },
            { question: 'What is floor division?', options: ['/', '//', '%', '**'], answer: 1 },
            { question: 'What handles errors?', options: ['if-else', 'try-except', 'while', 'for'], answer: 1 }
        ];

        function startBattleQuiz() {
            playerHealth = 100;
            aiHealth = 100;
            battleScore = 0;
            battleQuestionIndex = 0;
            
            document.getElementById('player-health').style.width = '100%';
            document.getElementById('ai-health').style.width = '100%';
            document.getElementById('player-health-text').textContent = 100;
            document.getElementById('ai-health-text').textContent = 100;
            document.getElementById('player-score').textContent = 0;
            document.getElementById('ai-score').textContent = 0;
            document.getElementById('battle-result').innerHTML = '';
            
            showBattleQuestion();
        }

        function showBattleQuestion() {
            if (playerHealth <= 0 || aiHealth <= 0 || battleQuestionIndex >= battleQuestions.length) {
                endBattle();
                return;
            }

            const q = battleQuestions[battleQuestionIndex];
            document.getElementById('player-area').classList.add('active');
            document.getElementById('ai-area').classList.remove('active');
            
            let html = `
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #667eea; margin-bottom: 20px;">Question ${battleQuestionIndex + 1}: ${q.question}</h3>
            `;
            
            q.options.forEach((opt, i) => {
                html += `
                    <button class="btn btn-secondary" onclick="battleAnswer(${i})" style="display: block; width: 100%; margin: 10px 0;">
                        ${opt}
                    </button>
                `;
            });
            
            html += '</div>';
            document.getElementById('battle-question-container').innerHTML = html;
        }

        function battleAnswer(selected) {
            const q = battleQuestions[battleQuestionIndex];
            const aiAnswer = Math.random() < 0.6 ? q.answer : Math.floor(Math.random() * q.options.length);
            
            let message = '';
            
            if (selected === q.answer) {
                battleScore += 20;
                aiHealth -= 20;
                message = '‚úÖ You answered correctly! AI takes 20 damage!';
            } else {
                playerHealth -= 20;
                message = '‚ùå Wrong answer! You take 20 damage!';
            }
            
            if (aiAnswer === q.answer) {
                playerHealth -= 10;
                message += '<br>ü§ñ AI also answered correctly! You take 10 damage!';
            } else {
                aiHealth -= 10;
                message += '<br>ü§ñ AI answered wrong! AI takes 10 damage!';
            }
            
            showCustomAlert(message, 'Battle Update', '‚öîÔ∏è', 'info');
            
            playerHealth = Math.max(0, playerHealth);
            aiHealth = Math.max(0, aiHealth);
            
            document.getElementById('player-health').style.width = playerHealth + '%';
            document.getElementById('ai-health').style.width = aiHealth + '%';
            document.getElementById('player-health-text').textContent = playerHealth;
            document.getElementById('ai-health-text').textContent = aiHealth;
            document.getElementById('player-score').textContent = battleScore;
            
            battleQuestionIndex++;
            showBattleQuestion();
        }

        function endBattle() {
            document.getElementById('player-area').classList.remove('active');
            document.getElementById('ai-area').classList.remove('active');
            document.getElementById('battle-question-container').innerHTML = '';
            
            let result = '';
            if (playerHealth > aiHealth) {
                result = `
                    <div style="background: linear-gradient(135deg, #d4edda, #c3e6cb); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <h2 style="color: #28a745;">üèÜ VICTORY!</h2>
                        <p style="font-size: 1.3em; color: #155724;">You defeated the AI!</p>
                        <p style="font-size: 1.2em;">Final Score: ${battleScore} points</p>
                    </div>
                `;
                promptPlayerName('battle-quiz', battleScore);
            } else if (aiHealth > playerHealth) {
                result = `
                    <div style="background: linear-gradient(135deg, #f8d7da, #f5c6cb); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <h2 style="color: #dc3545;">üíÄ DEFEAT</h2>
                        <p style="font-size: 1.3em; color: #721c24;">The AI won this time!</p>
                        <p style="font-size: 1.2em;">Your Score: ${battleScore} points</p>
                    </div>
                `;
            } else {
                result = `
                    <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <h2 style="color: #856404;">ü§ù DRAW!</h2>
                        <p style="font-size: 1.3em; color: #856404;">It's a tie!</p>
                        <p style="font-size: 1.2em;">Your Score: ${battleScore} points</p>
                    </div>
                `;
            }
            
            document.getElementById('battle-result').innerHTML = result;
        }
    </script>

</body>
</html>
