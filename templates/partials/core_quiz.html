{# Core Quiz Block: Handles single or multiple question types in a unified way. #}
{% if block.type == 'comprehensive_quiz' %}
  {% include 'partials/block_comprehensive_quiz.html' %}
{% else %}
<div class="comprehensive-quiz-container mcq-image-style mcq-inline" data-block-id="{{ block.id }}">
  <div class="mcq-ribbon">
    Quiz
  </div>
  <div class="quiz-header">
    <h3 class="quiz-title mcq-question">{{ block.instructions|default('Quiz') }}</h3>
    {% if block.questions %}
      <div class="quiz-progress">
        <span class="progress-indicator">Question <span class="current-question">1</span> of <span class="total-questions">{{ block.questions|length }}</span></span>
      </div>
    {% endif %}
  </div>

  <div class="quiz-body">
    {% set questions = block.questions if block.questions is defined else [block] %}
    {% for question_block in questions %}
      <div class="question-wrapper {% if not loop.first %}d-none{% endif %}" data-question-id="{{ question_block.id }}" data-question-type="{{ question_block.type }}">
        {% if question_block.type == 'multiple_choice' %}
          {% with block = question_block %}
            {% include 'partials/block_multiple_choice.html' %}
          {% endwith %}
        {% elif question_block.type == 'fill_in_the_blank' %}
          {% with block = question_block %}
            {% include 'partials/block_fill_in_blank.html' %}
          {% endwith %}
        {% elif question_block.type == 'drag_and_drop' %}
          {% with block = question_block %}
            {% include 'partials/block_drag_and_drop.html' %}
          {% endwith %}
        {% else %}
          <p><em>Unsupported question type: {{ question_block.type }}</em></p>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <div class="quiz-footer">
    <div class="feedback-container quiz-feedback"></div>
    <button class="btn mcq-option-btn next-question-btn d-none quiz-next-btn">Next Question</button>
  </div>

  <div class="quiz-summary-view d-none">
      <h3>Quiz Complete!</h3>
      <p>Your score: <span class="final-score"></span></p>
      <div class="quiz-action-container">
        <button class="btn mcq-option-btn retake-quiz-btn">Retake Quiz</button>
      </div>
  </div>
</div>
{% endif %}
