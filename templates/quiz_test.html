{% extends "base.html" %}

{% block title %}Quiz System Test - CodeLab{% endblock %}

{% block content %}
<main class="main-content" role="main">
  <div class="lesson-container">
    <div class="lesson-header">
      <h1>Quiz System Consolidation Test</h1>
      <p>Testing the unified quiz system functionality</p>
    </div>
    
    <div class="lesson-content">
      <!-- Test Multiple Choice Quiz -->
      <div class="quiz-block" data-quiz-type="multiple_choice" data-quiz-id="test_mcq">
        <div class="quiz-question">
          <h3>Test Multiple Choice Question</h3>
          <p>What is the purpose of the consolidated quiz system?</p>
        </div>
        <div class="quiz-options">
          <div class="quiz-option" data-value="0">
            <input type="radio" name="test_mcq" id="test_mcq_0" value="0">
            <label for="test_mcq_0">To unify all quiz functionality</label>
          </div>
          <div class="quiz-option" data-value="1">
            <input type="radio" name="test_mcq" id="test_mcq_1" value="1">
            <label for="test_mcq_1">To make quizzes more complex</label>
          </div>
          <div class="quiz-option" data-value="2">
            <input type="radio" name="test_mcq" id="test_mcq_2" value="2">
            <label for="test_mcq_2">To remove all quiz features</label>
          </div>
        </div>
        <div class="quiz-controls">
          <button class="quiz-submit-btn" onclick="submitQuiz('test_mcq', 0)">Submit Answer</button>
          <button class="quiz-hint-button" onclick="showHint('test_mcq')">Show Hint</button>
          <button class="quiz-reset-button" onclick="resetQuiz('test_mcq')">Reset</button>
        </div>
        <div class="quiz-feedback" style="display: none;"></div>
        <div class="quiz-hint" style="display: none;">
          <p>Think about what "consolidation" means in software development.</p>
        </div>
      </div>

      <!-- Test Fill in the Blank -->
      <div class="quiz-block" data-quiz-type="fill_in_blank" data-quiz-id="test_fib">
        <div class="quiz-question">
          <h3>Test Fill in the Blank</h3>
          <p>The consolidated quiz system replaces _______ legacy files.</p>
        </div>
        <div class="quiz-input-container">
          <input type="text" class="quiz-text-input" id="test_fib_input" placeholder="Enter your answer">
        </div>
        <div class="quiz-controls">
          <button class="quiz-submit-btn" onclick="submitQuiz('test_fib', 'four')">Submit Answer</button>
          <button class="quiz-hint-button" onclick="showHint('test_fib')">Show Hint</button>
          <button class="quiz-reset-button" onclick="resetQuiz('test_fib')">Reset</button>
        </div>
        <div class="quiz-feedback" style="display: none;"></div>
        <div class="quiz-hint" style="display: none;">
          <p>Count the number of files moved to the legacy_quiz_files directory.</p>
        </div>
      </div>

      <!-- JavaScript Test Results -->
      <div class="test-results-container" style="margin-top: 2rem; padding: 1rem; border: 1px solid #ccc; border-radius: 8px;">
        <h3>JavaScript Test Results</h3>
        <div id="test-output">
          <p>Run the tests by opening the browser console...</p>
        </div>
        <button onclick="runQuizTests()" class="quiz-submit-btn">Run Integration Tests</button>
      </div>
    </div>
  </div>
</main>

<script>
function runQuizTests() {
  const output = document.getElementById('test-output');
  output.innerHTML = '<p>Running tests... Check browser console for details.</p>';
  
  // Load and run the integration test
  if (!document.getElementById('integration-test-script')) {
    const script = document.createElement('script');
    script.id = 'integration-test-script';
    script.src = '/static/js/quiz_integration_test.js';
    script.onload = function() {
      setTimeout(() => {
        if (window.quizTestResults) {
          const results = window.quizTestResults;
          let html = '<h4>Test Results:</h4><ul>';
          Object.entries(results).forEach(([test, passed]) => {
            html += `<li>${test}: ${passed ? '✅ PASS' : '❌ FAIL'}</li>`;
          });
          html += '</ul>';
          const allPassed = Object.values(results).every(result => result);
          html += `<p><strong>Overall: ${allPassed ? '✅ ALL TESTS PASSED' : '❌ SOME TESTS FAILED'}</strong></p>`;
          output.innerHTML = html;
        }
      }, 1000);
    };
    document.head.appendChild(script);
  }
}
</script>
{% endblock %}
