{# Core Quiz Block: Handles single or multiple question types in a unified way. #}
{% if block.type == 'comprehensive_quiz' %}
  {% include 'partials/block_comprehensive_quiz.html' %}
{% elif block.questions and block.questions|length > 1 %}
  {# Multi-question quiz section - needs container #}
  <div class="quiz-section-container mcq-image-style mcq-inline" data-block-id="{{ block.id }}">
    <div class="mcq-ribbon">
      Quiz Section
    </div>
    <div class="quiz-header">
      <h3 class="quiz-title mcq-question">{{ block.instructions|default('Quiz Section') }}</h3>
      <div class="quiz-progress">
        <span class="progress-indicator">Question <span class="current-question">1</span> of <span class="total-questions">{{ block.questions|length }}</span></span>
      </div>
    </div>

    <div class="quiz-body">
      {% for question_block in block.questions %}
        <div class="question-wrapper {% if not loop.first %}d-none{% endif %}" data-question-id="{{ question_block.id }}" data-question-type="{{ question_block.type }}">
          {% if question_block.type == 'multiple_choice' %}
            {% with block = question_block %}
              {% include 'partials/block_multiple_choice.html' %}
            {% endwith %}
          {% elif question_block.type == 'fill_in_the_blank' %}
            {% with block = question_block %}
              {% include 'partials/block_fill_in_blank.html' %}
            {% endwith %}
          {% elif question_block.type == 'drag_and_drop' %}
            {% with block = question_block %}
              {% include 'partials/block_drag_and_drop.html' %}
            {% endwith %}
          {% else %}
            <p><em>Unsupported question type: {{ question_block.type }}</em></p>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <div class="quiz-footer">
      <div class="feedback-container quiz-feedback"></div>
      <!-- Removed Next Question button for Quiz 2.1 - auto-progression only -->
    </div>

    <!-- Quiz 2.1: Inline Summary Section -->
    <div class="quiz-summary-inline d-none mt-4 p-3 border rounded">
        <div class="quiz-summary-header text-center">
            <h4 class="text-success mb-2">ðŸŽ‰ Quiz Complete!</h4>
            <div class="quiz-summary-stats">
                <div class="score-display">
                    Score: <span class="summary-score font-weight-bold text-primary">--</span>
                </div>
                <div class="points-earned mt-2">
                    <span class="badge badge-success summary-points">+0 XP</span>
                </div>
            </div>
        </div>
        <div class="quiz-summary-actions text-center mt-3">
            <button class="btn btn-outline-primary btn-sm retake-quiz-btn">
                ðŸ”„ Retake Quiz (10 PyCoins)
            </button>
        </div>
    </div>
  </div>
{% else %}
  {# Single question - render directly without extra wrapper #}
  {% set question_block = block.questions[0] if block.questions else block %}
  {% if question_block.type == 'multiple_choice' %}
    {% with block = question_block %}
      {% include 'partials/block_multiple_choice.html' %}
    {% endwith %}
  {% elif question_block.type == 'fill_in_the_blank' %}
    {% with block = question_block %}
      {% include 'partials/block_fill_in_blank.html' %}
    {% endwith %}
  {% elif question_block.type == 'drag_and_drop' %}
    {% with block = question_block %}
      {% include 'partials/block_drag_and_drop.html' %}
    {% endwith %}
  {% else %}
    <p><em>Unsupported question type: {{ question_block.type }}</em></p>
  {% endif %}
{% endif %}
